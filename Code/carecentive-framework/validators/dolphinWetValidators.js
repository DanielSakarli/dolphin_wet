const { body } = require('express-validator');
/**
 * This file contains all validation rules of request body generated by express-validator.
 */

/**
 * Dolphin route validator.
 */
// Post request of dolphin endpoint validation rules.
const dolphinPostValidateRequestBody = [
	body('name').notEmpty().withMessage('Dolphin name is required'),
	body('sex')
		.isInt({ min: 0, max: 1 })
		.withMessage('Sex should be either 0 or 1'),
	body('on_site')
		.isInt({ min: 0, max: 1 })
		.withMessage('On-site value should be either 0 or 1'),
	body('year_of_birth')
		.isInt({ min: 1900, max: new Date().getFullYear() })
		.withMessage('Invalid year of birth'),
	body('place_of_birth').notEmpty().withMessage('Place of birth is required'),
];

// Patch request of dolphin endpoint validation rules.
const dolphinPatchValidateRequestBody = [
	// Validate update information
	body().custom((value) => {
		const allowedFields = [
			'on_site',
			'name',
			'sex',
			'year_of_birth',
			'place_of_birth',
		];
		const keys = Object.keys(value);

		// Check if any key is not allowed
		const disallowedKeys = keys.filter((key) => !allowedFields.includes(key));
		if (disallowedKeys.length > 0) {
			throw new Error(`Invalid update fields: ${disallowedKeys.join(', ')}`);
		}

		return true;
	}),
];
/**
 * End of Dolphin route validator.
 */

/**
 * Good feeding validation rules.
 */
const goodFeedingPostValidateRequestBody = [
	body('dolphin_name')
		.notEmpty()
		.isString()
		.withMessage('Invalid dolphin name'),
	body('body_condition_score')
		.optional({ values: 'null' })
		.isIn([1, 2, 3])
		.withMessage('Invalid body condition score'),
	body('weight')
		.optional({ values: 'null' })
		.isIn([1, 3])
		.withMessage('Invalid weight'),
	body('weight_measured')
		.optional({ values: 'null' })
		.isFloat({ min: 0 })
		.withMessage('Invalid measured weight'),
	body('kcal_calculations')
		.optional({ values: 'null' })
		.isIn([1, 3])
		.withMessage('Invalid kcal calculations'),
	body('blood_hydration')
		.optional({ values: 'null' })
		.isIn([1, 2, 3])
		.withMessage('Invalid blood hydration'),
	body('fish_quality')
		.optional({ values: 'null' })
		.isIn([1, 3])
		.withMessage('Invalid fish quality'),
	body('fish_variety')
		.optional({ values: 'null' })
		.isIn([1, 2, 3])
		.withMessage('Invalid fish variety'),
];
/**
 * End of Good feeding validation rules.
 */

/**
 * Good health validation rules.
 */
const goodHealthPostValidateRequestBody = [
	body().custom((value) => {
		const allowedFields = [
			'dolphin_name',
			'normal_floatability',
			'eye_lesions',
			'visual_cues',
			'mouth_exam',
			'respiratory_disease',
			'force_expiration',
			'external_disease_signs',
		];
		const keys = Object.keys(value);

		// Check if any key is not allowed
		const disallowedKeys = keys.filter((key) => !allowedFields.includes(key));
		if (disallowedKeys.length > 0) {
			throw new Error(
				`Invalid good_housing fields: ${disallowedKeys.join(', ')}`
			);
		}

		return true;
	}),
	body('dolphin_name')
		.notEmpty()
		.isString()
		.withMessage('Invalid dolphin name'),
	body('normal_floatability')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid normal floatability value'),
	body('eye_lesions')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid eye lesions value'),
	body('visual_cues')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid visual cues value'),
	body('mouth_exam')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid mouth exam value'),
	body('respiratory_disease')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid respiratory disease value'),
	body('force_expiration')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid force expiration value'),
	body('external_disease_signs')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt()
		.withMessage('Invalid external disease signs value'),
];
/**
 * End of Good health validation rules.
 */

/**
 * Good housing validation rules.
 */
const goodHousingPostValidateRequestBody = [
	body().custom((value) => {
		const allowedFields = [
			'dolphin_name',
			'enclosure_barrier_safety',
			'foreign_body_ingestion',
			'pool_design',
			'forced_loneliness',
			'water_quality',
			'sufficient_shade',
			'acoustic_comfort',
		];
		const keys = Object.keys(value);

		// Check if any key is not allowed
		const disallowedKeys = keys.filter((key) => !allowedFields.includes(key));
		if (disallowedKeys.length > 0) {
			throw new Error(
				`Invalid good_housing fields: ${disallowedKeys.join(', ')}`
			);
		}

		return true;
	}),
	body('dolphin_name')
		.notEmpty()
		.isString()
		.withMessage('Invalid dolphin name'),
	body('enclosure_barrier_safety')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('foreign_body_ingestion')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('pool_design')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('forced_loneliness')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('water_quality')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('water_temperature')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('sufficient_shade')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('acoustic_comfort')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
];
/**
 * End of good housing validation rules.
 */

/**
 * Behavior validation rules.
 */
const behaviorPostValidateRequestBody = [
	body('dolphin_name')
		.notEmpty()
		.isString()
		.withMessage('Invalid dolphin name'),
	body('environmental_enrichment')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('affiliative_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('play_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('socio_sexual_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('maternal_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('displacement_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('oral_stereotypic_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('repetitive_body_movement')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('self_grooming_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('regurgitation_reingestion')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('rake_marks')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('displaying_aggressive_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('receiving_aggressive_behaviour')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('social_isolation')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
	body('avoidance_pool_areas')
		.optional({ values: 'null' })
		.isInt({ min: 1, max: 3 })
		.toInt(),
];
/**
 * End of behavior validation rules.
 */

module.exports = {
	dolphinPostValidateRequestBody,
	dolphinPatchValidateRequestBody,
	goodFeedingPostValidateRequestBody,
	goodHealthPostValidateRequestBody,
	goodHousingPostValidateRequestBody,
	behaviorPostValidateRequestBody,
};
